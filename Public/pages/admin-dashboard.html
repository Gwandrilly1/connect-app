<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Admin dashboard for managing Connect platform - Kenya">
    <meta name="keywords" content="Connect, Kenya, admin, dashboard, analytics, M-Pesa">
    <title>Connect - Admin Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw==" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
    <script src="https://unpkg.com/@lottiefiles/lottie-player@1.5.7/dist/lottie-player.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
    <link rel="stylesheet" href="connect.css">
</head>
<body>
    <!-- Authentication Check -->
    <div id="authPrompt" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center">
        <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg">
            <h2 class="text-xl font-semibold mb-4" style="color: var(--text-color);">Admin Login</h2>
            <input type="password" id="adminPass" class="p-3 rounded-lg border mb-4 w-full" placeholder="Enter admin password" style="background: var(--card-bg); color: var(--text-color);">
            <button onclick="checkAuth()" class="btn btn-gradient-primary px-4 py-2 rounded-lg">Login</button>
        </div>
    </div>
    <nav class="navbar navbar-expand-lg fixed-top bg-gradient text-white shadow-lg" style="background: linear-gradient(to right, #1E40AF, #2563EB);">
        <div class="container">
            <a class="navbar-brand fw-bold text-white" href="../connect.html"><i class="fas fa-handshake me-2"></i>Connect</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNavDropdown" aria-controls="navbarNavDropdown" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNavDropdown">
                <ul class="navbar-nav ms-auto align-items-center">
                    <li class="nav-item"><a class="nav-link text-white hover:text-warning" href="connect.html"><i class="fas fa-home me-1"></i>Home</a></li>
                    <li class="nav-item"><a class="nav-link text-white hover:text-warning" href="admin-dashboard.html"><i class="fas fa-chart-line me-1"></i>Admin Dashboard</a></li>
                    <li class="nav-item me-2">
                        <button id="theme-toggle" class="nav-link text-white bg-transparent border-0" aria-label="Toggle dark mode">
                            <i class="fas fa-moon"></i>
                        </button>
                    </li>
                    <li class="nav-item">
                        <select id="languageToggle" class="p-2 rounded-lg text-white bg-transparent border-0" style="color: var(--text-color);" onchange="toggleLanguage(this.value)">
                            <option value="en">English</option>
                            <option value="sw">Swahili</option>
                        </select>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" data-bs-toggle="dropdown" aria-expanded="false">
                            <img src="../assets/img/avatar-placeholder.png" class="rounded-circle" width="40" height="40" alt="Admin">
                        </a>
                        <ul class="dropdown-menu dropdown-menu-end">
                            <li><a class="dropdown-item" href="#"><i class="fas fa-sign-out-alt me-2"></i>Logout</a></li>
                        </ul>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
    <button class="back-to-top" aria-label="Back to top">
        <i class="fas fa-chevron-up"></i>
    </button>
    <main>
        <section class="container mx-auto px-4 py-12 pt-28 animate__animated animate__slideInUp">
            <h1 class="text-3xl font-bold mb-6 text-center" style="color: var(--text-color);" data-i18n="adminDashboard">Admin Dashboard</h1>
            <!-- Alerts -->
            <div class="mb-6" id="alerts">
                <div class="bg-yellow-100 dark:bg-yellow-900 p-4 rounded-lg flex justify-between items-center" style="color: var(--text-color);">
                    <p><i class="fas fa-exclamation-circle me-2"></i>High error rate in job postings. <a href="#" class="text-amber-400">Investigate</a></p>
                    <button onclick="this.parentElement.remove()" aria-label="Close alert"><i class="fas fa-times"></i></button>
                </div>
            </div>
            <!-- Key Metrics -->
            <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-6">
                <div class="stat-card p-6 rounded-lg shadow-md text-center">
                    <h3 class="text-xl font-semibold" style="color: var(--text-color);" data-i18n="jobsCompleted">Jobs Completed</h3>
                    <p class="text-2xl font-bold" style="color: var(--text-color);" id="jobsCount">1,500</p>
                </div>
                <div class="stat-card p-6 rounded-lg shadow-md text-center">
                    <h3 class="text-xl font-semibold" style="color: var(--text-color);" data-i18n="revenue">Revenue</h3>
                    <p class="text-2xl font-bold" style="color: var(--text-color);" id="revenue">KSh 250,000</p>
                </div>
                <div class="stat-card p-6 rounded-lg shadow-md text-center">
                    <h3 class="text-xl font-semibold" style="color: var(--text-color);" data-i18n="activeUsers">Active Users</h3>
                    <p class="text-2xl font-bold" style="color: var(--text-color);" id="usersCount">6,000</p>
                </div>
                <div class="stat-card p-6 rounded-lg shadow-md text-center">
                    <h3 class="text-xl font-semibold" style="color: var(--text-color);" data-i18n="transactions">M-Pesa Transactions</h3>
                    <p class="text-2xl font-bold" style="color: var(--text-color);" id="transactionsCount">1,200</p>
                </div>
            </div>
            <!-- Charts -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                <div class="stat-card p-6 rounded-lg shadow-md">
                    <h2 class="text-xl font-semibold mb-4" style="color: var(--text-color);" data-i18n="jobsByRegion">Jobs by Region</h2>
                    <canvas id="regionChart" height="150"></canvas>
                </div>
                <div class="stat-card p-6 rounded-lg shadow-md">
                    <h2 class="text-xl font-semibold mb-4" style="color: var(--text-color);" data-i18n="revenueTrends">Revenue Trends</h2>
                    <canvas id="revenueChart" height="150"></canvas>
                </div>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                <div class="stat-card p-6 rounded-lg shadow-md">
                    <h2 class="text-xl font-semibold mb-4" style="color: var(--text-color);" data-i18n="userGrowth">User Growth</h2>
                    <canvas id="userChart" height="150"></canvas>
                </div>
                <div class="stat-card p-6 rounded-lg shadow-md">
                    <h2 class="text-xl font-semibold mb-4" style="color: var(--text-color);" data-i18n="serviceCategories">Service Categories</h2>
                    <canvas id="categoryChart" height="150"></canvas>
                </div>
            </div>
            <!-- Platform Health -->
            <div class="stat-card p-6 rounded-lg shadow-md mb-6">
                <h2 class="text-xl font-semibold mb-4" style="color: var(--text-color);" data-i18n="platformHealth">Platform Health</h2>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div class="text-center">
                        <h3 class="text-lg" style="color: var(--text-color);">Uptime</h3>
                        <p class="text-xl font-bold" style="color: var(--text-color);" id="uptime">99.9%</p>
                    </div>
                    <div class="text-center">
                        <h3 class="text-lg" style="color: var(--text-color);">API Response Time</h3>
                        <p class="text-xl font-bold" style="color: var(--text-color);" id="responseTime">200ms</p>
                    </div>
                    <div class="text-center">
                        <h3 class="text-lg" style="color: var(--text-color);">Error Rate</h3>
                        <p class="text-xl font-bold" style="color: var(--text-color);" id="errorRate">0.5%</p>
                    </div>
                </div>
            </div>
            <!-- User Management -->
            <div class="stat-card p-6 rounded-lg shadow-md mb-6">
                <h2 class="text-xl font-semibold mb-4" style="color: var(--text-color);" data-i18n="userManagement">User Management</h2>
                <div class="flex gap-4 mb-4">
                    <select id="userFilter" class="p-3 rounded-lg border focus:ring-2 focus:ring-amber-400" style="background: var(--card-bg); color: var(--text-color);">
                        <option value="">All Users</option>
                        <option value="client">Clients</option>
                        <option value="provider">Providers</option>
                        <option value="premium">Premium Providers</option>
                    </select>
                    <input type="text" id="userSearch" class="p-3 rounded-lg border focus:ring-2 focus:ring-amber-400" style="background: var(--card-bg); color: var(--text-color);" placeholder="Search users...">
                </div>
                <table class="w-full table-auto" id="userTable">
                    <thead>
                        <tr style="color: var(--text-color);">
                            <th class="p-2">Name</th>
                            <th class="p-2">Type</th>
                            <th class="p-2">Status</th>
                            <th class="p-2">Actions</th>
                        </tr>
                    </thead>
                    <tbody id="userList">
                        <!-- Populated via JS -->
                    </tbody>
                </table>
            </div>
            <!-- Job Logs -->
            <div class="stat-card p-6 rounded-lg shadow-md mb-6">
                <h2 class="text-xl font-semibold mb-4" style="color: var(--text-color);" data-i18n="jobLogs">Job Logs</h2>
                <div class="flex gap-4 mb-4">
                    <select id="jobFilter" class="p-3 rounded-lg border focus:ring-2 focus:ring-amber-400" style="background: var(--card-bg); color: var(--text-color);">
                        <option value="">All Statuses</option>
                        <option value="pending">Pending</option>
                        <option value="accepted">Accepted</option>
                        <option value="completed">Completed</option>
                    </select>
                    <button onclick="exportJobsCSV()" class="btn btn-gradient-primary px-4 py-2 rounded-lg">Export CSV</button>
                </div>
                <table class="w-full table-auto" id="jobTable">
                    <thead>
                        <tr style="color: var(--text-color);">
                            <th class="p-2">Title</th>
                            <th class="p-2">Provider</th>
                            <th class="p-2">Client</th>
                            <th class="p-2">Status</th>
                            <th class="p-2">Amount</th>
                        </tr>
                    </thead>
                    <tbody id="jobList">
                        <!-- Populated via JS -->
                    </tbody>
                </table>
            </div>
            <!-- M-Pesa Transactions -->
            <div class="stat-card p-6 rounded-lg shadow-md mb-6">
                <h2 class="text-xl font-semibold mb-4" style="color: var(--text-color);" data-i18n="transactions">M-Pesa Transactions</h2>
                <table class="w-full table-auto">
                    <thead>
                        <tr style="color: var(--text-color);">
                            <th class="p-2">Amount</th>
                            <th class="p-2">Job</th>
                            <th class="p-2">Date</th>
                            <th class="p-2">Action</th>
                        </tr>
                    </thead>
                    <tbody id="transactionList">
                        <!-- Populated via JS -->
                    </tbody>
                </table>
            </div>
            <!-- Gamification Insights -->
            <div class="stat-card p-6 rounded-lg shadow-md mb-6">
                <h2 class="text-xl font-semibold mb-4" style="color: var(--text-color);" data-i18n="gamification">Gamification Insights</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <h3 class="text-lg" style="color: var(--text-color);">Top Providers</h3>
                        <ul id="topProviders" class="space-y-2">
                            <!-- Populated via JS -->
                        </ul>
                    </div>
                    <div>
                        <h3 class="text-lg" style="color: var(--text-color);">Platform Milestones</h3>
                        <div class="progress-circle" style="--progress: 75;" aria-label="75% to 10,000 jobs"></div>
                        <p style="color: var(--text-color);">75% to 10,000 Jobs</p>
                    </div>
                </div>
            </div>
            <!-- Transaction Modal -->
            <div class="modal fade" id="transactionModal" tabindex="-1" aria-labelledby="transactionModalLabel" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content" style="background: var(--card-bg); color: var(--text-color);">
                        <div class="modal-header">
                            <h5 class="modal-title" id="transactionModalLabel">M-Pesa Receipt</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body" id="transactionDetails">
                            <!-- Populated via JS -->
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-gradient-primary" data-bs-dismiss="modal">Close</button>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>
    <footer class="text-white py-8" style="background: var(--gradient-primary)">
        <div class="container mx-auto px-4">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
                <div>
                    <h3 class="text-lg font-semibold mb-4">Connect</h3>
                    <p class="text-sm">Connecting you with trusted services and job opportunities across Kenya.</p>
                </div>
                <div>
                    <h3 class="text-lg font-semibold mb-4">Links</h3>
                    <ul class="space-y-2">
                        <li><a href="about.html" class="hover:underline">About</a></li>
                        <li><a href="contact.html" class="hover:underline">Contact</a></li>
                        <li><a href="faq.html" class="hover:underline">FAQ</a></li>
                        <li><a href="pricing.html" class="hover:underline">Pricing</a></li>
                    </ul>
                </div>
                <div>
                    <h3 class="text-lg font-semibold mb-4">Services</h3>
                    <ul class="space-y-2">
                        <li><a href="jobs.html?category=cleaning" class="hover:underline">Cleaning</a></li>
                        <li><a href="jobs.html?category=delivery" class="hover:underline">Delivery</a></li>
                        <li><a href="jobs.html?category=errands" class="hover:underline">Errands</a></li>
                        <li><a href="jobs.html?category=tutoring" class="hover:underline">Tutoring</a></li>
                    </ul>
                </div>
                <div>
                    <h3 class="text-lg font-semibold mb-4">Follow Us</h3>
                    <div class="flex gap-4">
                        <a href="#" class="text-white hover:text-amber-400"><i class="fab fa-facebook-f"></i></a>
                        <a href="#" class="text-white hover:text-amber-400"><i class="fab fa-twitter"></i></a>
                        <a href="#" class="text-white hover:text-amber-400"><i class="fab fa-instagram"></i></a>
                        <a href="#" class="text-white hover:text-amber-400"><i class="fab fa-linkedin-in"></i></a>
                    </div>
                </div>
            </div>
            <p class="mt-8 text-center text-sm">© 2025 Connect. All rights reserved.</p>
        </div>
    </footer>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <script>
        // Mock Authentication
        function checkAuth() {
            const password = document.getElementById('adminPass').value;
            if (password === 'admin123') { // Replace with secure auth in production
                localStorage.setItem('adminAuth', 'true');
                document.getElementById('authPrompt').classList.add('hidden');
                document.querySelector('main').classList.remove('hidden');
            } else {
                alert('Invalid password');
            }
        }

        // Check auth on load
        document.addEventListener('DOMContentLoaded', () => {
            if (localStorage.getItem('adminAuth') !== 'true') {
                document.getElementById('authPrompt').classList.remove('hidden');
                document.querySelector('main').classList.add('hidden');
            }
        });

        // Theme Toggle
        const toggleButton = document.getElementById('theme-toggle');
        const htmlElement = document.documentElement;
        const themeIcon = toggleButton.querySelector('i');
        const setTheme = (theme) => {
            htmlElement.setAttribute('data-theme', theme);
            localStorage.setItem('theme', theme);
            themeIcon.className = theme === 'dark' ? 'fas fa-sun' : 'fas fa-moon';
        };
        toggleButton.addEventListener('click', () => {
            const currentTheme = htmlElement.getAttribute('data-theme') || 'light';
            setTheme(currentTheme === 'light' ? 'dark' : 'light');
        });
        const savedTheme = localStorage.getItem('theme') || 'light';
        setTheme(savedTheme);

        // Language Toggle
        const translations = {
            en: {
                adminDashboard: 'Admin Dashboard',
                jobsCompleted: 'Jobs Completed',
                revenue: 'Revenue',
                activeUsers: 'Active Users',
                transactions: 'M-Pesa Transactions',
                jobsByRegion: 'Jobs by Region',
                revenueTrends: 'Revenue Trends',
                userGrowth: 'User Growth',
                serviceCategories: 'Service Categories',
                platformHealth: 'Platform Health',
                userManagement: 'User Management',
                jobLogs: 'Job Logs',
                gamification: 'Gamification Insights'
            },
            sw: {
                adminDashboard: 'Dashibodi ya Msimamizi',
                jobsCompleted: 'Kazi Zilizokamilika',
                revenue: 'Mapato',
                activeUsers: 'Watumiaji Wanaofanya Kazi',
                transactions: 'Miamala ya M-Pesa',
                jobsByRegion: 'Kazi kwa Mkoa',
                revenueTrends: 'Mwenendo wa Mapato',
                userGrowth: 'Ukuaji wa Watumiaji',
                serviceCategories: 'Jamii za Huduma',
                platformHealth: 'Afya ya Jukwaa',
                userManagement: 'Usimamizi wa Watumiaji',
                jobLogs: 'Rekodi za Kazi',
                gamification: 'Maarifa ya Gamification'
            }
        };

        function toggleLanguage(lang) {
            document.querySelectorAll('[data-i18n]').forEach(el => {
                el.textContent = translations[lang][el.dataset.i18n];
            });
            localStorage.setItem('language', lang);
        }

        document.getElementById('languageToggle').value = localStorage.getItem('language') || 'en';
        toggleLanguage(localStorage.getItem('language') || 'en');

        // Navbar Fix
        document.addEventListener('DOMContentLoaded', () => {
            const navbarToggler = document.querySelector('.navbar-toggler');
            const navbarCollapse = document.querySelector('#navbarNavDropdown');
            navbarToggler.addEventListener('click', () => {
                navbarCollapse.classList.toggle('show');
            });
        });

        // Intersection Observer for Animations
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.classList.add('animate__animated', 'animate__slideInUp');
                }
            });
        }, { threshold: 0.1 });
        document.querySelectorAll('section, .stat-card').forEach(el => observer.observe(el));

        // Back to Top Button
        const backToTop = document.querySelector('.back-to-top');
        window.addEventListener('scroll', () => {
            if (window.scrollY > 300) {
                backToTop.classList.add('show');
            } else {
                backToTop.classList.remove('show');
            }
        });
        backToTop.addEventListener('click', () => {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        });

        // Mock Data
        const adminData = {
            metrics: {
                jobs: 1500,
                revenue: 250000,
                users: { clients: 5000, providers: 1000 },
                transactions: 1200
            },
            jobs: [
                { id: 1, title: 'Web Developer', provider: 'John M.', client: 'Sarah K.', status: 'completed', amount: 5000, date: '2025-04-15' },
                { id: 2, title: 'Fundi', provider: 'Peter N.', client: 'Mary W.', status: 'accepted', amount: 2000, date: '2025-04-10' }
            ],
            users: [
                { id: 101, name: 'John M.', type: 'provider', status: 'active', badges: ['Top Fundi'] },
                { id: 102, name: 'Sarah K.', type: 'client', status: 'active', badges: ['Trusted Client'] }
            ],
            transactions: [
                { id: 1, amount: 5000, job: 'Web Developer', date: '2025-04-15', receipt: 'M-Pesa: KSh 5,000 to John M. on 2025-04-15' },
                { id: 2, amount: 2000, job: 'Fundi', date: '2025-04-10', receipt: 'M-Pesa: KSh 2,000 to Peter N. on 2025-04-10' }
            ],
            regions: [
                { region: 'Nairobi', jobs: 900 },
                { region: 'Mombasa', jobs: 400 },
                { region: 'Kisumu', jobs: 200 }
            ],
            revenueTrends: [
                { month: 'Jan', amount: 50000 },
                { month: 'Feb', amount: 75000 },
                { month: 'Mar', amount: 60000 },
                { month: 'Apr', amount: 65000 }
            ],
            userGrowth: [
                { month: 'Jan', clients: 1000, providers: 200 },
                { month: 'Feb', clients: 2000, providers: 400 },
                { month: 'Mar', clients: 3500, providers: 700 },
                { month: 'Apr', clients: 5000, providers: 1000 }
            ],
            categories: [
                { category: 'Tech', count: 500 },
                { category: 'Repairs', count: 600 },
                { category: 'Transport', count: 400 }
            ],
            health: {
                uptime: 99.9,
                responseTime: 200,
                errorRate: 0.5
            }
        };

        // Load Metrics
        function loadMetrics() {
            document.getElementById('jobsCount').textContent = adminData.metrics.jobs.toLocaleString();
            document.getElementById('revenue').textContent = `KSh ${adminData.metrics.revenue.toLocaleString()}`;
            document.getElementById('usersCount').textContent = (adminData.metrics.users.clients + adminData.metrics.users.providers).toLocaleString();
            document.getElementById('transactionsCount').textContent = adminData.metrics.transactions.toLocaleString();
            document.getElementById('uptime').textContent = `${adminData.health.uptime}%`;
            document.getElementById('responseTime').textContent = `${adminData.health.responseTime}ms`;
            document.getElementById('errorRate').textContent = `${adminData.health.errorRate}%`;
        }

        // Load Users
        function loadUsers() {
            const filter = document.getElementById('userFilter').value;
            const searchQuery = document.getElementById('userSearch').value.toLowerCase();
            const filteredUsers = adminData.users.filter(user => {
                const matchesFilter = filter ? (filter === 'premium' ? user.badges.includes('Premium') : user.type === filter) : true;
                const matchesSearch = user.name.toLowerCase().includes(searchQuery);
                return matchesFilter && matchesSearch;
            });

            document.getElementById('userList').innerHTML = filteredUsers.map(user => `
                <tr style="color: var(--text-color);">
                    <td class="p-2">${user.name}</td>
                    <td class="p-2">${user.type.charAt(0).toUpperCase() + user.type.slice(1)}</td>
                    <td class="p-2">${user.status.charAt(0).toUpperCase() + user.status.slice(1)}</td>
                    <td class="p-2">
                        <button onclick="suspendUser(${user.id})" class="btn btn-danger px-2 py-1 rounded-lg">Suspend</button>
                        <button onclick="promoteUser(${user.id})" class="btn btn-gradient-primary px-2 py-1 rounded-lg">Promote</button>
                    </td>
                </tr>
            `).join('');
        }

        // Load Jobs
        function loadJobs() {
            const filter = document.getElementById('jobFilter').value;
            const filteredJobs = adminData.jobs.filter(job => filter ? job.status === filter : true);

            document.getElementById('jobList').innerHTML = filteredJobs.map(job => `
                <tr style="color: var(--text-color);">
                    <td class="p-2">${job.title}</td>
                    <td class="p-2">${job.provider}</td>
                    <td class="p-2">${job.client}</td>
                    <td class="p-2">${job.status.charAt(0).toUpperCase() + job.status.slice(1)}</td>
                    <td class="p-2">KSh ${job.amount.toLocaleString()}</td>
                </tr>
            `).join('');
        }

        // Export Jobs CSV
        function exportJobsCSV() {
            const headers = ['ID,Title,Provider,Client,Status,Amount,Date'];
            const rows = adminData.jobs.map(job => `${job.id},${job.title},${job.provider},${job.client},${job.status},${job.amount},${job.date}`);
            const csv = headers.concat(rows).join('\n');
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'jobs_export.csv';
            a.click();
            URL.revokeObjectURL(url);
        }

        // Load Transactions
        function loadTransactions() {
            document.getElementById('transactionList').innerHTML = adminData.transactions.map(transaction => `
                <tr style="color: var(--text-color);">
                    <td class="p-2">KSh ${transaction.amount.toLocaleString()}</td>
                    <td class="p-2">${transaction.job}</td>
                    <td class="p-2">${transaction.date}</td>
                    <td class="p-2">
                        <button onclick="viewReceipt(${transaction.id})" class="btn btn-gradient-primary px-2 py-1 rounded-lg" data-bs-toggle="modal" data-bs-target="#transactionModal">View Receipt</button>
                    </td>
                </tr>
            `).join('');
        }

        // View Receipt
        function viewReceipt(id) {
            const transaction = adminData.transactions.find(t => t.id === id);
            document.getElementById('transactionDetails').innerHTML = `
                <p>${transaction.receipt}</p>
                <p><strong>Job:</strong> ${transaction.job}</p>
                <p><strong>Amount:</strong> KSh ${transaction.amount.toLocaleString()}</p>
                <p><strong>Date:</strong> ${transaction.date}</p>
            `;
        }

        // Load Top Providers
        function loadTopProviders() {
            const topProviders = adminData.users
                .filter(u => u.type === 'provider')
                .sort((a, b) => (b.badges.length || 0) - (a.badges.length || 0))
                .slice(0, 5);
            document.getElementById('topProviders').innerHTML = topProviders.map(provider => `
                <li style="color: var(--text-color);">${provider.name} - ${provider.badges.join(', ')}</li>
            `).join('');
        }

        // User Actions
        function suspendUser(id) {
            const user = adminData.users.find(u => u.id === id);
            if (user) {
                user.status = 'suspended';
                loadUsers();
                // Notify backend in production
            }
        }

        function promoteUser(id) {
            const user = adminData.users.find(u => u.id === id);
            if (user && user.type === 'provider') {
                user.badges = user.badges || [];
                if (!user.badges.includes('Premium')) user.badges.push('Premium');
                loadUsers();
                // Notify backend in production
            }
        }

        // Initialize Charts
        function initializeCharts() {
            // Jobs by Region
            new Chart(document.getElementById('regionChart'), {
                type: 'bar',
                data: {
                    labels: adminData.regions.map(r => r.region),
                    datasets: [{
                        label: 'Jobs',
                        data: adminData.regions.map(r => r.jobs),
                        backgroundColor: '#4FD1C5'
                    }]
                },
                options: { responsive: true, plugins: { legend: { labels: { color: 'var(--text-color)' } } }, scales: { x: { ticks: { color: 'var(--text-color)' } }, y: { ticks: { color: 'var(--text-color)' } } } }
            });

            // Revenue Trends
            new Chart(document.getElementById('revenueChart'), {
                type: 'line',
                data: {
                    labels: adminData.revenueTrends.map(r => r.month),
                    datasets: [{
                        label: 'Mapato (KSh)',
                        data: adminData.revenueTrends.map(r => r.amount),
                        borderColor: '#4FD1C5',
                        backgroundColor: 'rgba(79, 209, 197, 0.2)',
                        fill: true
                    }]
                },
                options: { responsive: true, plugins: { legend: { labels: { color: 'var(--text-color)' } } }, scales: { x: { ticks: { color: 'var(--text-color)' } }, y: { ticks: { color: 'var(--text-color)' } } } }
            });

            // User Growth
            new Chart(document.getElementById('userChart'), {
                type: 'line',
                data: {
                    labels: adminData.userGrowth.map(u => u.month),
                    datasets: [
                        {
                            label: 'Clients',
                            data: adminData.userGrowth.map(u => u.clients),
                            borderColor: '#2B6CB0',
                            backgroundColor: 'rgba(43, 108, 176, 0.2)',
                            fill: true
                        },
                        {
                            label: 'Providers',
                            data: adminData.userGrowth.map(u => u.providers),
                            borderColor: '#F59E0B',
                            backgroundColor: 'rgba(245, 158, 11, 0.2)',
                            fill: true
                        }
                    ]
                },
                options: { responsive: true, plugins: { legend: { labels: { color: 'var(--text-color)' } } }, scales: { x: { ticks: { color: 'var(--text-color)' } }, y: { ticks: { color: 'var(--text-color)' } } } }
            });

            // Service Categories
            new Chart(document.getElementById('categoryChart'), {
                type: 'pie',
                data: {
                    labels: adminData.categories.map(c => c.category),
                    datasets: [{
                        data: adminData.categories.map(c => c.count),
                        backgroundColor: ['#4FD1C5', '#2B6CB0', '#F59E0B']
                    }]
                },
                options: { responsive: true, plugins: { legend: { labels: { color: 'var(--text-color)' } } } }
            });
        }

        // Load Data
        document.addEventListener('DOMContentLoaded', () => {
            // Load cached data
            const cachedData = localStorage.getItem('adminData');
            if (cachedData) Object.assign(adminData, JSON.parse(cachedData));

            loadMetrics();
            loadUsers();
            loadJobs();
            loadTransactions();
            loadTopProviders();
            initializeCharts();

            // Event Listeners
            document.getElementById('userFilter').addEventListener('change', loadUsers);
            document.getElementById('userSearch').addEventListener('input', loadUsers);
            document.getElementById('jobFilter').addEventListener('change', loadJobs);

            // Cache data
            localStorage.setItem('adminData', JSON.stringify(adminData));
        });
    </script>
</body>
</html>