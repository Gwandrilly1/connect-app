<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Provider dashboard for managing jobs, earnings, and performance - Connect">
    <meta name="keywords" content="Connect, Kenya, services, dashboard, jobs, M-Pesa, fundi">
    <title>Connect - Provider Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw==" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
    <script src="https://unpkg.com/@lottiefiles/lottie-player@1.5.7/dist/lottie-player.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
    <link rel="stylesheet" href="../connect.css">
</head>
<body>
    <nav class="navbar navbar-expand-lg fixed-top bg-gradient text-white shadow-lg" style="background: linear-gradient(to right, #1E40AF, #2563EB);">
        <div class="container">
            <a class="navbar-brand fw-bold text-white" href="../connect.html"><i class="fas fa-handshake me-2"></i>Connect</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNavDropdown" aria-controls="navbarNavDropdown" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNavDropdown">
                <ul class="navbar-nav ms-auto align-items-center">
                    <li class="nav-item"><a class="nav-link text-white hover:text-warning" href="../connect.html"><i class="fas fa-home me-1"></i>Home</a></li>
                    <li class="nav-item"><a class="nav-link text-white hover:text-warning" href="jobs.html"><i class="fas fa-briefcase me-1"></i>Jobs</a></li>
                    <li class="nav-item"><a class="nav-link text-white hover:text-warning" href="map.html"><i class="fas fa-map-marker-alt me-1"></i>Map</a></li>
                    <li class="nav-item"><a class="nav-link text-white hover:text-warning" href="search.html"><i class="fas fa-search me-1"></i>Search</a></li>
                    <li class="nav-item"><a class="nav-link text-white hover:text-warning" href="faq.html"><i class="fas fa-question-circle me-1"></i>FAQ</a></li>
                    <li class="nav-item me-2">
                        <button id="theme-toggle" class="nav-link text-white bg-transparent border-0" aria-label="Toggle dark mode">
                            <i class="fas fa-moon"></i>
                        </button>
                    </li>
                    <li class="nav-item dropdown me-2">
                        <a class="nav-link text-white position-relative" href="notifications.html" data-bs-toggle="dropdown" aria-expanded="false">
                            <i class="fas fa-bell"></i>
                            <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger">3</span>
                        </a>
                        <ul class="dropdown-menu dropdown-menu-end p-0" style="width: 300px;">
                            <li class="p-2 bg-light fw-bold border-bottom">Notifications</li>
                            <li><a class="dropdown-item border-bottom" href="#"><span class="text-info">New booking:</span> John M. has booked your service</a></li>
                            <li><a class="dropdown-item border-bottom" href="#"><span class="text-success">Payment received:</span> KES 1,500</a></li>
                            <li><a class="dropdown-item" href="#"><span class="text-warning">Reminder:</span> Job at 9 AM</a></li>
                            <li class="text-center p-2"><a href="notifications.html" class="small">View all</a></li>
                        </ul>
                    </li>
                    <li class="nav-item dropdown me-2">
                        <a class="nav-link text-white position-relative" href="messages.html" data-bs-toggle="dropdown" aria-expanded="false">
                            <i class="fas fa-envelope"></i>
                            <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-success">2</span>
                        </a>
                        <ul class="dropdown-menu dropdown-menu-end p-0" style="width: 300px;">
                            <li class="p-2 bg-light fw-bold border-bottom">Messages</li>
                            <li><a class="dropdown-item border-bottom" href="messages.html"><strong>John M:</strong> What time will you arrive?</a></li>
                            <li><a class="dropdown-item" href="messages.html"><strong>Sarah K:</strong> Thank you for yesterday!</a></li>
                        </ul>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle text-white" href="#" data-bs-toggle="dropdown" aria-expanded="false">
                            <i class="fas fa-ellipsis-h me-1"></i>More
                        </a>
                        <ul class="dropdown-menu dropdown-menu-end">
                            <li><a class="dropdown-item" href="about.html"><i class="fas fa-info-circle me-2"></i>About</a></li>
                            <li><a class="dropdown-item" href="contact.html"><i class="fas fa-envelope me-2"></i>Contact</a></li>
                            <li><a class="dropdown-item" href="pricing.html"><i class="fas fa-tag me-2"></i>Pricing</a></li>
                            <li><a class="dropdown-item" href="safety.html"><i class="fas fa-shield-alt me-2"></i>Safety</a></li>
                            <li><a class="dropdown-item" href="blog.html"><i class="fas fa-blog me-2"></i>Blog</a></li>
                            <li><a class="dropdown-item" href="language.html"><i class="fas fa-globe me-2"></i>Language</a></li>
                        </ul>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" data-bs-toggle="dropdown" aria-expanded="false">
                            <img src="../assets/img/avatar-placeholder.png" class="rounded-circle" width="40" height="40" alt="User">
                        </a>
                        <ul class="dropdown-menu dropdown-menu-end">
                            <li><a class="dropdown-item" href="profile.html"><i class="fas fa-user me-2"></i>Profile</a></li>
                            <li><a class="dropdown-item" href="wallet.html"><i class="fas fa-wallet me-2"></i>Wallet</a></li>
                            <li><a class="dropdown-item" href="provider-dashboard.html"><i class="fas fa-chart-line me-2"></i>Dashboard</a></li>
                            <li><a class="dropdown-item" href="edit-profile.html"><i class="fas fa-edit me-2"></i>Edit Profile</a></li>
                            <li><a class="dropdown-item" href="settings.html"><i class="fas fa-cog me-2"></i>Settings</a></li>
                            <li><a class="dropdown-item" href="#"><i class="fas fa-sign-out-alt me-2"></i>Logout</a></li>
                        </ul>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
    <button class="back-to-top" aria-label="Back to top">
        <i class="fas fa-chevron-up"></i>
    </button>
    <main>
        <section class="container mx-auto px-4 py-12 pt-28 animate__animated animate__slideInUp">
            <h1 class="text-3xl font-bold mb-6 text-center" style="color: var(--text-color);">Provider Dashboard</h1>
            <!-- Alerts -->
            <div class="mb-6" id="alerts">
                <div class="bg-yellow-100 dark:bg-yellow-900 p-4 rounded-lg flex justify-between items-center" style="color: var(--text-color);">
                    <p><i class="fas fa-exclamation-circle me-2"></i>Complete your profile to rank higher! <a href="edit-profile.html" class="text-amber-400">Update now</a></p>
                    <button onclick="this.parentElement.remove()" aria-label="Close alert"><i class="fas fa-times"></i></button>
                </div>
            </div>
            <!-- Profile Metrics -->
            <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-6">
                <div class="stat-card p-6 rounded-lg shadow-md text-center">
                    <div class="progress-circle" style="--progress: 80;" aria-label="Profile completion 80%"></div>
                    <h3 class="text-xl font-semibold" style="color: var(--text-color);">Profile Completion</h3>
                    <p style="color: var(--text-color);">80% - Add a photo to boost!</p>
                    <a href="edit-profile.html" class="btn btn-gradient-primary px-4 py-2 rounded-lg mt-2">Boost Profile</a>
                </div>
                <div class="stat-card p-6 rounded-lg shadow-md text-center">
                    <h3 class="text-xl font-semibold" style="color: var(--text-color);">Average Rating</h3>
                    <div class="flex justify-center gap-1 text-yellow-400 my-2">
                        <i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star-half-alt"></i>
                    </div>
                    <p style="color: var(--text-color);">4.5 / 5</p>
                </div>
                <div class="stat-card p-6 rounded-lg shadow-md text-center">
                    <h3 class="text-xl font-semibold" style="color: var(--text-color);">Jobs Completed</h3>
                    <p class="text-2xl font-bold" style="color: var(--text-color);">25</p>
                    <p style="color: var(--text-color);">Top 5% in Nairobi</p>
                </div>
                <div class="stat-card p-6 rounded-lg shadow-md text-center">
                    <h3 class="text-xl font-semibold" style="color: var(--text-color);">Profile Views</h3>
                    <p class="text-2xl font-bold" style="color: var(--text-color);">1,200</p>
                    <p style="color: var(--text-color);">This month</p>
                </div>
            </div>
            <!-- Charts -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                <div class="stat-card p-6 rounded-lg shadow-md">
                    <h2 class="text-xl font-semibold mb-4" style="color: var(--text-color);">Mapato (Earnings)</h2>
                    <canvas id="earningsChart" height="150"></canvas>
                    <p class="text-center mt-4" style="color: var(--text-color);">Total: KSh 10,000 this month</p>
                </div>
                <div class="stat-card p-6 rounded-lg shadow-md">
                    <h2 class="text-xl font-semibold mb-4" style="color: var(--text-color);">Job Categories</h2>
                    <canvas id="categoryChart" height="150"></canvas>
                </div>
            </div>
            <div class="stat-card p-6 rounded-lg shadow-md mb-6">
                <h2 class="text-xl font-semibold mb-4" style="color: var(--text-color);">Profile Views Over Time</h2>
                <canvas id="viewsChart" height="150"></canvas>
            </div>
            <!-- Job Applications -->
            <div class="stat-card p-6 rounded-lg shadow-md mb-6">
                <h2 class="text-xl font-semibold mb-4" style="color: var(--text-color);">Kazi (Job Applications)</h2>
                <div class="flex gap-4 mb-4">
                    <select id="statusFilter" class="p-3 rounded-lg border focus:ring-2 focus:ring-amber-400" style="background: var(--card-bg); color: var(--text-color);">
                        <option value="">All Statuses</option>
                        <option value="pending">Pending</option>
                        <option value="accepted">Accepted</option>
                        <option value="completed">Completed</option>
                    </select>
                    <input type="text" id="jobSearch" class="p-3 rounded-lg border focus:ring-2 focus:ring-amber-400" style="background: var(--card-bg); color: var(--text-color);" placeholder="Search jobs...">
                </div>
                <table class="w-full table-auto" id="jobTable">
                    <thead>
                        <tr style="color: var(--text-color);">
                            <th class="p-2">Job Title</th>
                            <th class="p-2">Location</th>
                            <th class="p-2">Status</th>
                            <th class="p-2">Date</th>
                            <th class="p-2">Actions</th>
                        </tr>
                    </thead>
                    <tbody id="jobList">
                        <!-- Populated via JS -->
                    </tbody>
                </table>
            </div>
            <!-- M-Pesa Transactions -->
            <div class="stat-card p-6 rounded-lg shadow-md">
                <h2 class="text-xl font-semibold mb-4" style="color: var(--text-color);">M-Pesa Transactions</h2>
                <table class="w-full table-auto">
                    <thead>
                        <tr style="color: var(--text-color);">
                            <th class="p-2">Amount</th>
                            <th class="p-2">Job</th>
                            <th class="p-2">Date</th>
                            <th class="p-2">Action</th>
                        </tr>
                    </thead>
                    <tbody id="transactionList">
                        <!-- Populated via JS -->
                    </tbody>
                </table>
            </div>
            <!-- Transaction Modal -->
            <div class="modal fade" id="transactionModal" tabindex="-1" aria-labelledby="transactionModalLabel" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content" style="background: var(--card-bg); color: var(--text-color);">
                        <div class="modal-header">
                            <h5 class="modal-title" id="transactionModalLabel">M-Pesa Receipt</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body" id="transactionDetails">
                            <!-- Populated via JS -->
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-gradient-primary" data-bs-dismiss="modal">Close</button>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>
    <footer class="text-white py-8" style="background: var(--gradient-primary)">
        <div class="container mx-auto px-4">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
                <div>
                    <h3 class="text-lg font-semibold mb-4">Connect</h3>
                    <p class="text-sm">Connecting you with trusted services and job opportunities across Kenya.</p>
                </div>
                <div>
                    <h3 class="text-lg font-semibold mb-4">Links</h3>
                    <ul class="space-y-2">
                        <li><a href="about.html" class="hover:underline">About</a></li>
                        <li><a href="contact.html" class="hover:underline">Contact</a></li>
                        <li><a href="faq.html" class="hover:underline">FAQ</a></li>
                        <li><a href="pricing.html" class="hover:underline">Pricing</a></li>
                    </ul>
                </div>
                <div>
                    <h3 class="text-lg font-semibold mb-4">Services</h3>
                    <ul class="space-y-2">
                        <li><a href="jobs.html?category=cleaning" class="hover:underline">Cleaning</a></li>
                        <li><a href="jobs.html?category=delivery" class="hover:underline">Delivery</a></li>
                        <li><a href="jobs.html?category=errands" class="hover:underline">Errands</a></li>
                        <li><a href="jobs.html?category=tutoring" class="hover:underline">Tutoring</a></li>
                    </ul>
                </div>
                <div>
                    <h3 class="text-lg font-semibold mb-4">Follow Us</h3>
                    <div class="flex gap-4">
                        <a href="#" class="text-white hover:text-amber-400"><i class="fab fa-facebook-f"></i></a>
                        <a href="#" class="text-white hover:text-amber-400"><i class="fab fa-twitter"></i></a>
                        <a href="#" class="text-white hover:text-amber-400"><i class="fab fa-instagram"></i></a>
                        <a href="#" class="text-white hover:text-amber-400"><i class="fab fa-linkedin-in"></i></a>
                    </div>
                </div>
            </div>
            <p class="mt-8 text-center text-sm">© 2025 Connect. All rights reserved.</p>
        </div>
    </footer>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <script>
        // Theme Toggle
        const toggleButton = document.getElementById('theme-toggle');
        const htmlElement = document.documentElement;
        const themeIcon = toggleButton.querySelector('i');
        const setTheme = (theme) => {
            htmlElement.setAttribute('data-theme', theme);
            localStorage.setItem('theme', theme);
            themeIcon.className = theme === 'dark' ? 'fas fa-sun' : 'fas fa-moon';
        };
        toggleButton.addEventListener('click', () => {
            const currentTheme = htmlElement.getAttribute('data-theme') || 'light';
            setTheme(currentTheme === 'light' ? 'dark' : 'light');
        });
        const savedTheme = localStorage.getItem('theme') || 'light';
        setTheme(savedTheme);

        // Navbar Fix
        document.addEventListener('DOMContentLoaded', () => {
            const navbarToggler = document.querySelector('.navbar-toggler');
            const navbarCollapse = document.querySelector('#navbarNavDropdown');
            navbarToggler.addEventListener('click', () => {
                navbarCollapse.classList.toggle('show');
            });
        });

        // Intersection Observer for Animations
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.classList.add('animate__animated', 'animate__slideInUp');
                }
            });
        }, { threshold: 0.1 });
        document.querySelectorAll('section, .stat-card').forEach(el => observer.observe(el));

        // Back to Top Button
        const backToTop = document.querySelector('.back-to-top');
        window.addEventListener('scroll', () => {
            if (window.scrollY > 300) {
                backToTop.classList.add('show');
            } else {
                backToTop.classList.remove('show');
            }
        });
        backToTop.addEventListener('click', () => {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        });

        // Mock Data
        const dashboardData = {
            jobs: [
                { id: 1, title: 'Web Developer', category: 'tech', location: 'Nairobi', status: 'pending', date: '2025-04-15', clientId: 101 },
                { id: 2, title: 'Fundi', category: 'repairs', location: 'Mombasa', status: 'accepted', date: '2025-04-10', clientId: 102 },
                { id: 3, title: 'Boda Boda', category: 'transport', location: 'Kisumu', status: 'completed', date: '2025-04-05', clientId: 103 }
            ],
            transactions: [
                { id: 1, amount: 5000, job: 'Web Developer', date: '2025-04-15', receipt: 'M-Pesa: KSh 5,000 to John M. on 2025-04-15' },
                { id: 2, amount: 2000, job: 'Fundi', date: '2025-04-10', receipt: 'M-Pesa: KSh 2,000 to Sarah K. on 2025-04-10' }
            ],
            earnings: [
                { month: 'Jan', amount: 8000 },
                { month: 'Feb', amount: 12000 },
                { month: 'Mar', amount: 10000 },
                { month: 'Apr', amount: 5000 }
            ],
            categories: [
                { category: 'Tech', count: 10 },
                { category: 'Repairs', count: 8 },
                { category: 'Transport', count: 7 }
            ],
            views: [
                { week: 'Week 1', count: 300 },
                { week: 'Week 2', count: 400 },
                { week: 'Week 3', count: 350 },
                { week: 'Week 4', count: 150 }
            ]
        };

        // Load Jobs
        function loadJobs() {
            const statusFilter = document.getElementById('statusFilter').value;
            const searchQuery = document.getElementById('jobSearch').value.toLowerCase();
            const filteredJobs = dashboardData.jobs.filter(job => {
                const matchesStatus = statusFilter ? job.status === statusFilter : true;
                const matchesSearch = job.title.toLowerCase().includes(searchQuery) || job.location.toLowerCase().includes(searchQuery);
                return matchesStatus && matchesSearch;
            });

            document.getElementById('jobList').innerHTML = filteredJobs.map(job => `
                <tr style="color: var(--text-color);">
                    <td class="p-2">${job.title}</td>
                    <td class="p-2">${job.location}</td>
                    <td class="p-2">${job.status.charAt(0).toUpperCase() + job.status.slice(1)}</td>
                    <td class="p-2">${job.date}</td>
                    <td class="p-2">
                        ${job.status === 'pending' ? `<button onclick="acceptJob(${job.id})" class="btn btn-gradient-primary px-2 py-1 rounded-lg">Accept</button>` : ''}
                        <a href="messages.html?client=${job.clientId}" class="btn btn-accent px-2 py-1 rounded-lg">Message</a>
                    </td>
                </tr>
            `).join('');

            // Cache jobs
            localStorage.setItem('dashboardJobs', JSON.stringify(dashboardData.jobs));
        }

        // Load Transactions
        function loadTransactions() {
            document.getElementById('transactionList').innerHTML = dashboardData.transactions.map(transaction => `
                <tr style="color: var(--text-color);">
                    <td class="p-2">KSh ${transaction.amount}</td>
                    <td class="p-2">${transaction.job}</td>
                    <td class="p-2">${transaction.date}</td>
                    <td class="p-2">
                        <button onclick="viewReceipt(${transaction.id})" class="btn btn-gradient-primary px-2 py-1 rounded-lg" data-bs-toggle="modal" data-bs-target="#transactionModal">View Receipt</button>
                    </td>
                </tr>
            `).join('');

            // Cache transactions
            localStorage.setItem('dashboardTransactions', JSON.stringify(dashboardData.transactions));
        }

        // View Receipt
        function viewReceipt(id) {
            const transaction = dashboardData.transactions.find(t => t.id === id);
            document.getElementById('transactionDetails').innerHTML = `
                <p>${transaction.receipt}</p>
                <p><strong>Job:</strong> ${transaction.job}</p>
                <p><strong>Amount:</strong> KSh ${transaction.amount}</p>
                <p><strong>Date:</strong> ${transaction.date}</p>
            `;
        }

        // Accept Job
        function acceptJob(id) {
            const job = dashboardData.jobs.find(j => j.id === id);
            if (job) {
                job.status = 'accepted';
                loadJobs();
                // Notify backend in production
            }
        }

        // Initialize Charts
        function initializeCharts() {
            // Earnings Chart
            new Chart(document.getElementById('earningsChart'), {
                type: 'line',
                data: {
                    labels: dashboardData.earnings.map(e => e.month),
                    datasets: [{
                        label: 'Mapato (KSh)',
                        data: dashboardData.earnings.map(e => e.amount),
                        borderColor: '#4FD1C5',
                        backgroundColor: 'rgba(79, 209, 197, 0.2)',
                        fill: true
                    }]
                },
                options: { responsive: true, plugins: { legend: { labels: { color: 'var(--text-color)' } } }, scales: { x: { ticks: { color: 'var(--text-color)' } }, y: { ticks: { color: 'var(--text-color)' } } } }
            });

            // Category Chart
            new Chart(document.getElementById('categoryChart'), {
                type: 'pie',
                data: {
                    labels: dashboardData.categories.map(c => c.category),
                    datasets: [{
                        data: dashboardData.categories.map(c => c.count),
                        backgroundColor: ['#4FD1C5', '#2B6CB0', '#F59E0B']
                    }]
                },
                options: { responsive: true, plugins: { legend: { labels: { color: 'var(--text-color)' } } } }
            });

            // Views Chart
            new Chart(document.getElementById('viewsChart'), {
                type: 'bar',
                data: {
                    labels: dashboardData.views.map(v => v.week),
                    datasets: [{
                        label: 'Profile Views',
                        data: dashboardData.views.map(v => v.count),
                        backgroundColor: '#4FD1C5'
                    }]
                },
                options: { responsive: true, plugins: { legend: { labels: { color: 'var(--text-color)' } } }, scales: { x: { ticks: { color: 'var(--text-color)' } }, y: { ticks: { color: 'var(--text-color)' } } } }
            });
        }

        // Load Data
        document.addEventListener('DOMContentLoaded', () => {
            // Load cached data
            const cachedJobs = localStorage.getItem('dashboardJobs');
            const cachedTransactions = localStorage.getItem('dashboardTransactions');
            if (cachedJobs) dashboardData.jobs = JSON.parse(cachedJobs);
            if (cachedTransactions) dashboardData.transactions = JSON.parse(cachedTransactions);

            loadJobs();
            loadTransactions();
            initializeCharts();

            // Event Listeners
            document.getElementById('statusFilter').addEventListener('change', loadJobs);
            document.getElementById('jobSearch').addEventListener('input', loadJobs);
        });
    </script>
</body>
</html>